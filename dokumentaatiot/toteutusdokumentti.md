## Toteutusdokumentti

Ohjelma on toteutettu vastaamaan pääpiirteittäin määrittelydokumentissa esitettyjä vaatimuksia. Ratkaisijabotin osalta algoritmia piti muuttaa toteutukseltaa hieman helpommaksi projektin aikataulutusvaikeuksien vuoksi. 

### Ohjelma yleisrakenne
Ohjelma rakentuu kuvan mukaisista osioista. Pelivalikoista aloituksessa pelaaja päättää pelaako itse vaiko katsoo botin pelaamista. Tasot-valikossa pelaaja valitsee vaikeustaso, jonka mukaan pelikenttä generoidaan ja pelisilmukka luodaan. Ohjelman suoritus siirtyy pelisilmukkaan, jossa suoritetaan pelaajan/botin antamaa syötettä, kunnes peli loppuu joko voittoon tai häviöön. Tämän jälkeen päädytään lopetusvalikkoon, jossa pelaaja pystyy valitsemaan haluaako pelata uudelleen, vaihtaa vaikeustasoa tai palata aloitusvalikkoon. Näkyvillä on koko ajan vain yksi näkymä, joko jokin valikoista tai itse peli. Ohjelma noteraa syötteenä vain hiiren klikkaukset sekä valikoissa että pelisilmukassa.  

![alt text](https://github.com/Na-na13/Minesweeper/blob/master/kuvat/rakennekaavio.png)

Jokainen valikko, pelikenttä, botti ja pelisilmukka on toteutettu omana luokkanaan. Lisäksi botin simuloimia syötteitä varten on totetutettu luokka Events, joka luo ihmispelaajan syötettä vastaavan syötteolion pelisilmukalle, sekä luokka Clock, joka tahdistaa pelisilmukan toimintaa niin, että se pyritään suorittamaan 60 kertaa sekunnissa. Botin suoriutumisen testaamiseen on vielä olemassa oma luokkansa, Tester, joka pyytää syötteenä haluttua vaikeustasoa ja pelin toiston kertoja ja näiden perusteella luo pelikentän ja pelisilmukassa pelaa syötteen mukaisen määrän pelejä. Pelin pelaamisesta on kerrottu enemmän [Käyttöohjeessa](https://github.com/Na-na13/Minesweeper/blob/master/dokumentaatiot/kayttoohje.md) ja suoritetuista testauksista botin suhteen on kerrottu enemmän [Testausdokumentissa](https://github.com/Na-na13/Minesweeper/blob/master/dokumentaatiot/testausdokumentti.md).

### Algoritmi
Määrittelydokumentissa oli esitelty ratkaisujabotin toimintaa siten, että peli muunnetaan rajoitelaskennan ongelmaksi. Tämä osoitteutui liian haastavaksi toteuttaa projektin aikarajojen puitteissa, joten ratkaisualgoritmia on yksinkertaistettu. Aloitusruutu on botilla aina sama ollen vasen ylänurkka. Aloituksen jälkeen botti etsii pelikentän puskuriruudut eli pelikentän ne ruudut, jotka erottavat avatutruudut avaamattomista ruuduista ja sisältävät vihjeluvun naapuriruuduissa sijaitsevista miinoista. Tämän jälkeen botti etsii vuorotelle kaikki varmat miinaruudut ja kaikki varmat miinattomat ruudut puskuriruutujen vihjeiden perusteella. Etsintä on toteutettu siten, että botti vertailee vihjeruudun *x* vihjeen lukuarvoa ruudun *x* avaamattomien naapuriruutujen lukumäärään sekä mahdollisiin miinaepäilyihin naapuriruuduissa. Jos naapuriruuduissa ei ole vielä yhtään miinaepäilyä ja vihje vastaa avaamattomien naapuriruutujen lukumäärää, on kaikissa naapuriruuduissa miina. Vastaavalla tavalla etsitään kaikki varmat miinattomat ruudut.

Varsinkin vaikeimmalla vaikeustasolla eteen tulee väistämättä tilanteita, joissa botti ei pysty etenemään etsimällä varmoja miina-/miinatomia ruutuja. Silloin botin täytyy valita satunnaisesti jokin ruutu avattavaksi. Satunaiseksi ruuduksi valitaan ensin reunaruutu, kunnes kaikki reunaruudut ruudut on avattu. Tämän jälkeen satunnaiseksi ruuduksi valikoituu jokin puskuriruutujen naapuriruuduista. Tällä periaatteella on suurempi todennäköisyys saada pelikenttää avattua enemmän niin, että botti pystyy jälleen etsimään varmoja miina-/miinattomia ruutuja. Jos botti ei pysty yhden satunnaisesti avatun ruudun jälkeen edelleenkään jatkamaan, avataan satunnaisia ruutuja niin kauan, kunnes pelikenttää avautuu sen verran, että botti pystyy jälleen jatkamaan miina-/miinattomien ruutujen etsintää.

[Testausdokumentissa](https://github.com/Na-na13/Minesweeper/blob/master/dokumentaatiot/testausdokumentti.md) on esitelty tarkemmin botin suoriutumista eri vaikeustasoilla. Ratkaisualgoritmi toimii kohtalaisen hyvin helpolla tasolla, mutta vaikeimmalla tasolla sen suoriutuminen on selkeästi heikompaa. Tähän vaikuttaa paljon botin hyödyntämä satunnaisten ruutujen avaaminen. Botin toimintaa parantaisi, jos se määrittelydokumentissa esitellyn algoritmin mukaisesti ennemmän laskisi todennäköisyyksiä miinoille kuin mielivaltaisesti valitsisi avattavan ruudun.

### Aikavaativuus
Pelin toiminta perustuu vahvasti kaksiulotteisten taulukoiden läpikäyntiin. Näiden osalta aikavaativuus on *O(wh)*, kun *w* on pelikentän leveys ja *h* pelikentän korkeus. Joissakin tilanteissa funktioita olisi voinut tehostaa esim. pelisilmukan funktiossa *is_won* taulukoiden läpikäynnin olisi voinut kiertää pitämällä kirjaa avattujen ruutujen lukumäärästä. Toisaalta kaksiulotteisessa taulukossa on aina korkeintaan 480 alkioita, joka ei määrällisesti ole kovin suuri eikä siksi välttämättä tarvita enempää tehokkuutta. Pelin pelaamisessaa ei ilmene viivettä, ei myöskää botin pelaamisessa.

### Puutteet

