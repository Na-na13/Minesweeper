## Toteutusdokumentti

Ohjelma on toteutettu vastaamaan pääpiirteittäin määrittelydokumentissa esitettyjä vaatimuksia. Ratkaisijabotin osalta algoritmia piti muuttaa toteutukseltaa hieman yksinkertaisemmaksi projektin aikataulutusvaikeuksien vuoksi. 

### Ohjelma yleisrakenne
Ohjelma rakentuu alla olevan kuvan mukaisista osioista. Pelivalikoista aloituksessa pelaaja päättää pelaako itse vaiko katsoo botin pelaamista. Tasot-valikossa pelaaja valitsee vaikeustaso, jonka mukaan pelikenttä generoidaan ja pelisilmukka luodaan. Ohjelman suoritus siirtyy pelisilmukkaan, jossa suoritetaan pelaajan/botin antamaa syötettä, kunnes peli loppuu joko voittoon tai häviöön. Tämän jälkeen päädytään lopetusvalikkoon, jossa pelaaja pystyy valitsemaan haluaako pelata uudelleen, vaihtaa vaikeustasoa tai palata aloitusvalikkoon. Näkyvillä on koko ajan vain yksi näkymä, joko jokin valikoista tai itse peli. Ohjelma noteraa syötteenä vain hiiren klikkaukset sekä valikoissa että pelisilmukassa.  

![alt text](https://github.com/Na-na13/Minesweeper/blob/master/kuvat/rakennekaavio.png)

Jokainen valikko, pelikenttä, botti ja pelisilmukka on toteutettu omana luokkanaan. Lisäksi botin simuloimia syötteitä varten on totetutettu luokka Events, joka luo ihmispelaajan syötettä vastaavan syöteolion pelisilmukalle, sekä luokka Clock, joka tahdistaa pelisilmukan toimintaa niin, että se pyritään suorittamaan 60 kertaa sekunnissa. Botin suoriutumisen testaamiseen on vielä olemassa oma luokkansa, Tester, joka pyytää syötteenä haluttua vaikeustasoa ja pelin toiston kertoja ja näiden perusteella luo pelikentän ja pelisilmukassa pelaa syötteen mukaisen määrän pelejä. Pelin pelaamisesta on kerrottu enemmän [Käyttöohjeessa](https://github.com/Na-na13/Minesweeper/blob/master/dokumentaatiot/kayttoohje.md) ja suoritetuista testauksista botin suhteen on kerrottu enemmän [Testausdokumentissa](https://github.com/Na-na13/Minesweeper/blob/master/dokumentaatiot/testausdokumentti.md).

### Algoritmi
Määrittelydokumentissa oli esitelty ratkaisujabotin toimintaa siten, että peli muunnetaan rajoitelaskennan ongelmaksi. Tämä osoitteutui liian haastavaksi toteuttaa projektin aikarajojen puitteissa, joten ratkaisualgoritmia on yksinkertaistettu. Aloitusruutu on botilla aina sama ollen vasen ylänurkka. Aloituksen jälkeen botti etsii pelikentän puskuriruudut eli pelikentän ne ruudut, jotka erottavat avatut ruudut avaamattomista ruuduista ja sisältävät vihjeluvun naapuriruuduissa sijaitsevista miinoista. Tämän jälkeen botti etsii vuorotelle kaikki varmat miinaruudut ja kaikki varmat miinattomat ruudut puskuriruutujen vihjeiden perusteella. Etsintä on toteutettu siten, että botti vertailee vihjeruudun *x* vihjeen lukuarvoa ruudun *x* avaamattomien naapuriruutujen lukumäärään sekä mahdollisiin miinaepäilyihin naapuriruuduissa. Jos naapuriruuduissa ei ole vielä yhtään miinaepäilyä ja vihje vastaa avaamattomien naapuriruutujen lukumäärää, on kaikissa naapuriruuduissa miina. Jos naapuriruutuihin on merkattu vihjeluvun verran miinaepäilyjä, ovat kaikki muut avaamattomat naapuriruudut turvallisia avata.

Varsinkin vaikeimmalla vaikeustasolla eteen tulee väistämättä tilanteita, joissa botti ei pysty etenemään edellä esitetyllä tavalla etsimällä varmoja miina-/miinatomia ruutuja. Silloin botin täytyy valita mielivaltaisesti jokin ruutu avattavaksi. Satunaiseksi ruuduksi valitaan ensin reunaruutu, kunnes kaikki reunaruudut ruudut on avattu. Tämän jälkeen satunnaiseksi ruuduksi valikoituu jokin puskuriruutujen naapuriruuduista. Tällä periaatteella on suurempi todennäköisyys saada pelikenttää avattua enemmän niin, että botti pystyy jälleen etsimään varmoja miina-/miinattomia ruutuja. Jos botti ei pysty yhden satunnaisesti avatun ruudun jälkeen edelleenkään jatkamaan, avataan satunnaisia ruutuja niin kauan, kunnes pelikenttää avautuu sen verran, että botti pystyy jälleen jatkamaan miina-/miinattomien ruutujen etsintää.

[Testausdokumentissa](https://github.com/Na-na13/Minesweeper/blob/master/dokumentaatiot/testausdokumentti.md) on esitelty tarkemmin botin suoriutumista eri vaikeustasoilla. Ratkaisualgoritmi toimii kohtalaisen hyvin helpolla tasolla, mutta vaikeimmalla tasolla sen suoriutuminen on selkeästi heikompaa. Tähän vaikuttaa paljon botin hyödyntämä satunnaisten ruutujen avaaminen. Botin toimintaa parantaisi, jos se määrittelydokumentissa esitellyn algoritmin mukaisesti ennemmin laskisi todennäköisyyksiä miinoille kuin mielivaltaisesti valitsisi avattavan ruudun.

### Aikavaativuus
Pelin toiminta perustuu vahvasti kaksiulotteisten taulukoiden läpikäyntiin. Näiden osalta aikavaativuus on *O(wh)*, kun *w* on pelikentän leveys ja *h* pelikentän korkeus. Joissakin tilanteissa funktioita olisi voinut tehostaa esim. pelisilmukan funktiossa *is_won* taulukoiden läpikäynnin olisi voinut kiertää pitämällä kirjaa avattujen ruutujen lukumäärästä. Toisaalta kaksiulotteisessa taulukossa on aina korkeintaan 480 alkioita (vaiken taso on 30 x 16), joka ei määrällisesti ole kovin suuri eikä siksi välttämättä tarvita enempää tehokkuutta. Pelin pelaamisessaa ei ilmene viivettä, ei myöskää botin pelaamisessa.

### Puutteet
Pelin toiminnassa ei ole ilmennyt vakavia puutteita eli peli itsessään toimii kuten pitkän. Ohjelman puutteet ovatkin enemmän kosmeettisia. Pelivalikot jäivät hiukan karkeatekoisiksi, sillä ne ovat toteutettu *pygamen* rajallisilla toiminnalisuuksilla. Loppumetreillä yritin vaihtaa niiden toteutuksen pohjautumaan *tkinter*-kirjastoon, mutta en saanut toimimaan sitä halutulla tavalla. Alla kuvat ohjelman *pygamella* tehdystä aloitusvalikosta (vasen), joka päätyi ohjelmaan, sekä *tkinterilla* tehdystä valikosta (oikea).

![alt text](https://github.com/Na-na13/Minesweeper/blob/master/kuvat/pygame_aloitus.png)       ![alt text](https://github.com/Na-na13/Minesweeper/blob/master/kuvat/tkinter_aloitus.png) 

Muissakin valikoissa on joitakin kosmeettisia vikoja, kuten lopetusvalikossa näkyvä peliin käytetyn ajan sijoittelu ja keskimmäisen painikkeen tekstin sijoittelu (menee painikkeen reunojen yli). Koska valikot oli tarkoitus muuttaa kokonaan toimimaan toisella tavalla, on myös niiden koodi hiukan sekava ja toisteinen eikä sitä ole kommentoitu.

Yksi suuri puute koko projektissa on yksikkötestejen lähes täydellinen puute. En ole vastaavanlaista projektia aikaisemmin toteuttanut, joten testien tekeminen ei oikein luonnistunut, vaikka tietyt testauskohteet olivatkin selkeitä, kuten miinojen oikein määrän tarkistaminen ja miinavihjeiden oikea sijoittelu. 
